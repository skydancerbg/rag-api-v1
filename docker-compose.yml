# docker-compose.yml v1 (Portainer + GitHub compatible)

services:
  rag-api:
    container_name: rag-api
    build:
      context: ./            # Portainer clones repo into this directory
      dockerfile: Dockerfile
    ports:
      - "5005:5005"
    volumes:
      # IMPORTANT: Portainer keeps repo folder name!
      - ./rag-api-v1/rag-api:/app/rag_api:ro
      - /mnt/ai-rag-files:/mnt/ai-rag-files:ro
    environment:
      - QDRANT_URL=http://10.100.10.2:6333
      - COLLECTION_NAME=documents
      - DOC_PATH=/mnt/ai-rag-files
      - OLLAMA_URL=http://10.10.10.5:11434
      - OLLAMA_MODEL=gpt-oss:20b
      - TOP_K=5
      - CHUNK_SIZE=500
      - INGEST_INTERVAL_MIN=10
      - UVICORN_WORKERS=1
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -sSf http://localhost:5005/ || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3
