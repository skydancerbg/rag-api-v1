# docker-compose.yml v1 (corrected for GitHub + Portainer)
services:
  rag-api:
    container_name: rag-api
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "5005:5005"                       # rag-api listens on 5005
    volumes:
      - ./rag-api:/app/rag_api:ro         # project files inside container
      - /mnt/ai-rag-files:/mnt/ai-rag-files:ro  # NFS documents
    environment:
      # External services (already running in your setup)
      - QDRANT_URL=http://10.100.10.2:6333
      - COLLECTION_NAME=documents
      - DOC_PATH=/mnt/ai-rag-files
      - OLLAMA_URL=http://10.10.10.5:11434
      - OLLAMA_MODEL=gpt-oss:20b
      - TOP_K=5
      - CHUNK_SIZE=500
      - INGEST_INTERVAL_MIN=10
      # Runtime tuning
      - UVICORN_WORKERS=1
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -sSf http://localhost:5005/ || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3
